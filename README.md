# Todoリストアプリ

Googleスプレッドシートを使用してデータを保存するTodoリストアプリケーションです。

## 機能

- ✅ Todoの登録（タイトル・内容・期日を設定可能）
- ✅ Todoの編集
- ✅ Todoの削除
- ✅ Todo一覧の表示
- ✅ Googleスプレッドシートへの自動保存

## セットアップ手順

### 1. 必要なパッケージのインストール

```bash
pip install -r requirements.txt
```

### 2. Google Cloud Platformの設定

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. 新しいプロジェクトを作成
3. 「APIとサービス」→「ライブラリ」から以下を有効化：
   - Google Sheets API
   - Google Drive API
4. 「認証情報」→「認証情報を作成」→「サービスアカウント」を選択
5. サービスアカウントを作成し、JSONキーをダウンロード
6. ダウンロードしたJSONファイルを`credentials.json`としてプロジェクトルートに配置

### 3. スプレッドシートの作成と設定

**方法A: 既存のスプレッドシートを使用（推奨）**

Google Driveのストレージ容量が超過している場合や、既存のスプレッドシートを使用したい場合：

1. [Googleスプレッドシート](https://sheets.google.com/)にアクセス
2. 新しいスプレッドシートを作成（または既存のものを使用）
3. スプレッドシートのURLからIDを取得
   - URLの形式: `https://docs.google.com/spreadsheets/d/【ここがID】/edit`
   - 例: `https://docs.google.com/spreadsheets/d/1a2b3c4d5e6f7g8h9i0j/edit` → IDは `1a2b3c4d5e6f7g8h9i0j`
4. スプレッドシートを開き、「共有」ボタンをクリック
5. サービスアカウントのメールアドレス（`credentials.json`内の`client_email`）を追加し、「編集者」権限を付与
6. ワークシート名を「Todos」に変更（または新規ワークシートを作成して「Todos」と命名）
7. 1行目に以下のヘッダーを設定（手動で入力）:
   ```
   ID | タイトル | 内容 | 期日 | 作成日時
   ```

**方法B: 自動作成（ストレージ容量に余裕がある場合のみ）**

初回実行時にスプレッドシートが自動的に作成されます（現在はストレージ容量超過のため使用不可）。

### 4. 環境変数の設定

`.env`ファイルに以下を設定してください：

```
SPREADSHEET_ID=your_spreadsheet_id_here
SECRET_KEY=your-secret-key-change-this-in-production
PORT=5001
LINE_NOTIFY_TOKEN=your_line_notify_token_here
```

**注意**: 
- `SPREADSHEET_ID`は上記の手順で取得したスプレッドシートIDを設定してください
- macOSではポート5000がAirPlay Receiverで使用されているため、デフォルトでポート5001を使用します。別のポートを使用する場合は`PORT`環境変数を設定してください
- `LINE_NOTIFY_TOKEN`はLine通知機能を使用する場合のみ必要です（下記の「Line通知機能の設定」を参照）

### 5. Line通知機能の設定（オプション）

期日1日前にLine通知を受け取りたい場合は、以下の手順で設定してください。

#### ステップ1: Line Notifyにアクセス

1. [Line Notify](https://notify-bot.line.me/)にアクセス
2. 「登録してログイン」または「ログイン」をクリック
3. Lineアカウントでログイン

#### ステップ2: トークンを発行

1. ログイン後、右上の自分の名前をクリック
2. 「マイページ」を選択
3. 下にスクロールして「トークンを発行する」をクリック
4. 以下の情報を入力：
   - **トークン名**: 「Todoリストアプリ」など任意の名前
   - **通知を送信するトークルーム**: 「1-on-1でLINE Notifyから通知を受け取る」を選択（自分だけに通知が届きます）
5. 「発行する」をクリック
6. **表示されたトークンをコピー**（このトークンは後で見られないため、必ずコピーしてください）

#### ステップ3: .envファイルにトークンを設定

1. `.env`ファイルを開く
2. `LINE_NOTIFY_TOKEN=コピーしたトークン`を追加
   ```
   LINE_NOTIFY_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ```
3. ファイルを保存

#### ステップ4: 動作確認

1. アプリケーションを起動
2. Todoに期日を設定（明日の日付）
3. アプリケーションを起動したまま、翌日の午前9時まで待つか、手動で通知をテストする場合：
   ```python
   from line_notify import check_due_tasks
   check_due_tasks()
   ```

**注意**: 
- Line通知は毎日午前9時に自動実行されます
- 期日が1日前（明日）のタスクがある場合のみ通知が送信されます
- `LINE_NOTIFY_TOKEN`が設定されていない場合、通知機能は無効になります（アプリケーションは正常に動作します）

## アプリケーションの起動

```bash
python app.py
```

ブラウザで `http://localhost:5001` にアクセスしてください（デフォルトポート）。

**注意**: macOSでポート5000が使用されている場合は、自動的にポート5001で起動します。起動時に表示されるURLを確認してください。

## プロジェクト構造

```
todo_app/
├── app.py                 # Flaskアプリケーションのメインファイル
├── sheets_helper.py       # Google Sheets APIのヘルパー関数
├── requirements.txt       # 必要なパッケージ一覧
├── credentials.json       # Google API認証情報（.gitignoreに追加済み）
├── .env                   # 環境変数（.gitignoreに追加済み）
├── templates/             # HTMLテンプレート
│   ├── base.html         # ベーステンプレート
│   ├── index.html        # Todo一覧ページ
│   ├── add.html          # Todo追加ページ
│   └── edit.html         # Todo編集ページ
└── README.md             # このファイル
```

## 使い方

1. **Todoの追加**: トップページの「新しいTodoを追加」ボタンをクリック
   - タイトル、内容、期日、重要度（高/中/低）を設定できます
2. **Todoの編集**: 各Todo項目の「編集」ボタンをクリック
3. **Todoの完了**: 各Todo項目の「完了」ボタンをクリックすると、タスクが完了となりアーカイブページに移動します
4. **Todoの削除**: 各Todo項目の「削除」ボタンをクリック（確認ダイアログが表示されます）
5. **アーカイブの確認**: トップページの「アーカイブ」ボタンから完了したタスク一覧を確認できます
6. **並び替え**: トップページの「並び替え」ドロップダウンから「重要度順」または「期日順」を選択できます
7. **重要度の表示**: 各Todo項目に重要度がバッジで表示されます（高=赤、中=黄、低=緑）

## Line通知機能について

### 通知のタイミング

- **毎日午前9時に自動実行**されます
- **期日が1日前（明日）**のタスクがある場合のみ通知が送信されます
- 通知には、タスクのタイトル、内容、期日、重要度が含まれます

### 通知を受け取るには

1. 上記の「Line通知機能の設定」を完了してください
2. Todoに期日を設定してください（YYYY-MM-DD形式）
3. アプリケーションを起動したままにしておいてください（バックグラウンドで動作します）

### 通知が届かない場合

- `.env`ファイルに`LINE_NOTIFY_TOKEN`が正しく設定されているか確認してください
- アプリケーションが起動していることを確認してください（スケジューラーはアプリケーションと一緒に動作します）
- 期日が正しく設定されているか確認してください（明日の日付である必要があります）

## トラブルシューティング

### エラー: "Permission denied" または "Access denied"

- スプレッドシートがサービスアカウントと共有されているか確認してください
- `credentials.json`が正しい場所に配置されているか確認してください

### エラー: "Spreadsheet not found"

- `.env`ファイルの`SPREADSHEET_ID`が正しく設定されているか確認してください
- スプレッドシートがサービスアカウントと共有されているか確認してください

### エラー: "Drive storage quota has been exceeded"

- Google Driveのストレージ容量が超過しています
- 既存のスプレッドシートを使用する方法（上記の「方法A」）を参照してください
- または、Google Driveの容量を解放してください

### エラー: "Module not found"

- `pip install -r requirements.txt`を実行して、すべてのパッケージがインストールされているか確認してください

### エラー: "Port 5000 is in use"

- macOSではポート5000がAirPlay Receiverで使用されている場合があります
- アプリケーションは自動的にポート5001で起動します
- 別のポートを使用したい場合は、`.env`ファイルに`PORT=8000`のように設定してください

## 本番環境へのデプロイ

本番環境にデプロイする場合は、以下の点に注意してください：

1. `app.secret_key`を環境変数から取得するように変更
2. `debug=True`を`False`に変更
3. 適切なWSGIサーバー（例: Gunicorn）を使用
4. HTTPSを有効化

## よくある質問

### 1. スマホでも使えますか？

**はい、使えます！**

このアプリケーションはレスポンシブデザインに対応しており、スマートフォンやタブレットでも快適に使用できます。

**ローカルで使用する場合（現在の設定）:**
- PCとスマホが同じWi-Fiネットワークに接続されている必要があります
- アプリケーションを起動したPCのIPアドレスを使用してアクセスします
  - 例: `http://192.168.1.100:5001`（IPアドレスは起動したPCのものに置き換えてください）
- PCのIPアドレスを確認する方法:
  - macOS: `ifconfig | grep "inet " | grep -v 127.0.0.1`
  - Windows: `ipconfig`（IPv4アドレスを確認）

**インターネット経由で使用する場合:**
- サーバーにデプロイする必要があります（Heroku、AWS、Google Cloud Platformなど）
- ドメインまたはIPアドレスでアクセス可能になります

### 2. どういう仕組みで動いていますか？料金などはかからないですか？

#### 仕組み

1. **Flask（Python Webフレームワーク）**
   - Webアプリケーションのサーバーとして動作
   - ブラウザからのリクエストを受けて、HTMLページを返します

2. **Google Sheets API**
   - データの保存先としてGoogleスプレッドシートを使用
   - すべてのTodoデータはスプレッドシートに保存されます

3. **データフロー**
   ```
   ブラウザ → Flaskアプリ → Google Sheets API → Googleスプレッドシート
   ```

#### 料金について

**基本的に無料です！**

- **Flaskアプリケーション**: 無料（オープンソース）
- **Google Sheets API**: 
  - **無料枠**: 1日あたり約60,000回のリクエスト（個人利用では十分）
  - このアプリケーションでは、1回のTodo操作で数回のAPIリクエストを使用します
  - 通常の個人利用では無料枠内で十分に使用できます
  - 詳しくは[Google Cloud Pricing](https://cloud.google.com/pricing)をご確認ください

**注意点:**
- Google Cloud Platformのプロジェクトを作成する必要がありますが、これも無料です
- サーバーにデプロイする場合（Heroku、AWSなど）は、ホスティングサービスの料金がかかる場合があります（ローカルで使用する場合は不要）

## ライセンス

このプロジェクトは学習目的で作成されています。

