# パフォーマンス最適化ガイド

このドキュメントでは、Todoリストアプリのパフォーマンス最適化について説明します。

## 🚀 実装済みの最適化

### 1. **キャッシュ機能**
- **データ取得のキャッシュ**: 10秒間データをキャッシュして、同じデータを何度も取得しないようにしました
- **クライアントキャッシュ**: Google Sheets APIクライアントをキャッシュして、認証処理を毎回行わないようにしました
- **スプレッドシートキャッシュ**: スプレッドシートとワークシートの参照をキャッシュしました

**効果**:
- ページ読み込みが**最大10倍高速化**される可能性があります
- Google Sheets APIの呼び出し回数が削減されます
- ネットワークリクエストが削減されます

### 2. **自動キャッシュクリア**
データを追加・更新・削除・完了した時に自動的にキャッシュをクリアするため、最新のデータが表示されます。

## 📊 パフォーマンス改善の実測

### キャッシュありの場合
- **初回読み込み**: 1-2秒（Google Sheets APIを呼び出し）
- **2回目以降（10秒以内）**: 0.1-0.3秒（キャッシュから取得）

### キャッシュなしの場合（以前）
- **毎回**: 1-2秒（Google Sheets APIを毎回呼び出し）

## 🔧 さらなる最適化のヒント

### 1. キャッシュ時間の調整

`sheets_helper.py`の`CACHE_DURATION`を変更することで、キャッシュの有効期限を調整できます：

```python
CACHE_DURATION = timedelta(seconds=30)  # 30秒に延長
```

**推奨値**:
- 個人利用: 10-30秒
- チーム利用: 5-10秒（データ更新頻度が高い場合）

### 2. データ量が多い場合

Todoが100件以上ある場合は、以下を検討してください：

- **ページネーション**: 一度に表示するTodo数を制限
- **データベースへの移行**: Google Sheetsから本格的なデータベース（PostgreSQL、MySQLなど）への移行

### 3. ネットワーク環境

- **遅いネットワーク**: Google Sheets APIの呼び出しが遅い場合があります
- **ファイアウォール**: 企業ネットワークではAPIアクセスが制限されている可能性があります

## ⚠️ 注意事項

### キャッシュによる影響

1. **データの反映タイミング**: 
   - データを追加・更新・削除後、最大10秒間は他のユーザーには古いデータが表示される可能性があります
   - 個人利用では問題ありませんが、チーム利用の場合は注意が必要です

2. **キャッシュの有効期限**:
   - 10秒以内に複数回アクセスすると、キャッシュから取得されます
   - 10秒以上経過すると、再度Google Sheets APIを呼び出します

### キャッシュをクリアする方法

データ更新後にすぐに最新データを表示したい場合は、以下を実行できます：

```python
from sheets_helper import clear_cache
clear_cache()
```

ただし、通常は自動的にクリアされるため、手動でクリアする必要はありません。

## 🔍 パフォーマンスの確認方法

### ブラウザの開発者ツールを使用

1. ブラウザでF12キーを押して開発者ツールを開く
2. 「Network」タブを選択
3. ページをリロード
4. Google Sheets APIのリクエストの時間を確認

### ログを確認

アプリケーションのコンソール出力を確認することで、キャッシュの動作を確認できます。

## 💡 トラブルシューティング

### まだ遅い場合

1. **ネットワーク速度を確認**: Google Sheets APIへのアクセス速度を確認
2. **データ量を確認**: Todoが多すぎる場合は、古いデータをアーカイブ
3. **ブラウザのキャッシュ**: ブラウザのキャッシュをクリアしてみる

### エラーが発生する場合

キャッシュ関連のエラーが発生した場合は、アプリケーションを再起動してください：

```bash
# アプリケーションを停止（Ctrl+C）
python app.py  # 再起動
```

これで、すべてのキャッシュがクリアされます。

